{% from 'macros/pagination.htm' import render_pagination %}

{% extends 'content.htm' %}

{% block includes %}
    <script type="text/javascript" language="javascript" src="//cdn.datatables.net/1.10.3/js/jquery.dataTables.js"></script>
    <script type="text/javascript" language="javascript" src="//cdn.datatables.net/plug-ins/380cb78f450/integration/bootstrap/3/dataTables.bootstrap.js"></script>
{% endblock %}

{% block content %}
<h1>Gebruiker overzicht</h1>

<div class='row'>
	<div class='col-md-12'>
        <table id="datatable" class='table table-striped'>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>E-mail adres</th>
                    <th>Voornaam</th>
                    <th>Achternaam</th>
                    <th>Student ID</th>
                    <th>Studie</th>
                    <th>Lid</th>
                    <th>Erelid</th>
                    <th>Begunstiger</th>
                    <th></th>
                </tr>
            </thead>
            <tfoot>
                <tr>
                    <th>ID</th>
                    <th>E-mail adres</th>
                    <th>Voornaam</th>
                    <th>Achternaam</th>
                    <th>Student ID</th>
                    <th>Studie</th>
                    <th>Lid</th>
                    <th>Erelid</th>
                    <th>Begunstiger</th>
                    <th></th>
                </tr>
            </tfoot>
        </table>

        <div class='btn-group'>
            <a href='/users/create' class='btn btn-success'>
                <i class='glyphicon glyphicon-user'></i> Gebruiker aanmaken
            </a>

            <a id='delete' class='btn btn-danger'>
                <i class='glyphicon glyphicon-remove'></i> Verwijderen
            </a>

            <a href='/users/export' class='btn btn-success'>
                <i class='glyphicon glyphicon-export'></i> Gebruikers Exporteren
            </a>
        </div>
	</div>
</div>
<script>
    $(document).ready(function() {
        var table = $('#datatable').DataTable( {
            "processing":true,
            "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
            "language": {
                "paginate": {
                    "next": "Volgende",
                    "previous": "Vorige"
                }
            },
            "columnDefs": [ {
                "targets": [0],
                "visible": false,
                "searchable": false
            }],
            "ajax": {
                "url": "/users/api/get_users/",
                "type": "post"
            }
        });

        $("#datatable").css('cursor', 'pointer');
        $('#datatable tbody').on( 'click', 'tr', function () {
            $(this).toggleClass('info');
        } );

        $('#delete').click( function () {
            var selected_ids = [];
            var selected_users = "";
            var selected_rows = table.rows('.info')
            for (i = 0; i < selected_rows.data().length; i++) {
                selected_ids.push(selected_rows.data()[i][0]);
                selected_users += "- " + selected_rows.data()[i][1] + "\n";
            }

            console.log(selected_ids);

            var json_data = { "selected_ids" : selected_ids }
            if (confirm('Do you surely want to delete these users?\n' + selected_users )) {
                $.ajax({
                    type: "POST",
                    url: "/users/api/delete_users/",
                    contentType: 'application/json',
                    success: function (data) {
                        table.ajax.reload();
                    },
                    data: JSON.stringify(json_data, null, '\t')
                });

            } else {
                return;
            }
        } );
    } );
</script>
{% endblock %}
